## 20220603 TIL

**JPA(Java Persistence API)** : ìŠ¤í”„ë§ì„ ìœ„í•´ íƒœì–´ë‚¬ë‹¤ Java codeë¥¼ ì‘ì„±ì‹œ SQLë¡œ ë²ˆì—­í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤

SQLì„ ì‘ì„±í•  í•„ìš” ì—†ì´ Java Collectionsì„ ì´ìš©í•˜ëŠ” ê²ƒ ê°™ì´ ì‚¬ìš©í•œë‹¤.

ê°œë°œ ì†ë„, ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›Œì§„ë‹¤

ê°ì²´ë¥¼ ì˜ ë§¤í•‘í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

----------



## JPA (Java Persistence API)

JPAëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒì´ë‹¤

**ìë°” ì§„ì˜ì˜ ORM (Object-Relational Mapping) ê¸°ìˆ  í‘œì¤€**

ê°ì²´ëŠ” ê°ì²´ëŒ€ë¡œ ì„¤ê³„, ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŒ€ë¡œ ì„¤ê³„í•˜ë©´ ORM Frameworkê°€ ì¤‘ê°„ì—ì„œ ë§¤í•‘í•´ ì¤€ë‹¤

ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ JDBC ì‚¬ì´ì—ì„œ ë™ì‘í•˜ëŠ” ê²ƒğŸ˜ƒ



#### JPAì˜ ì—­í• 

- JPAê°€ ë©¤ë²„ ê°ì²´ë¥¼ ë¶„ì„í•´ì„œ Queryë¥¼ ë§Œë“¤ì–´ ê²°ê³¼ë¥¼ ì£¼ê³  ë°›ëŠ”ë‹¤

- ResultSet ë§¤í•‘

- íŒ¨ëŸ¬ë‹¤ì„ì˜ ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•œë‹¤.



#### JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?

1. ìƒì‚°ì ì´ë‹¤. ë§ˆì¹˜ java collectionì„ ì“°ëŠ” ê²ƒê³¼ ê°™ë‹¤

2. ìœ ì§€ë³´ìˆ˜ê°€ ì¢‹ë‹¤
   - í•„ë“œ ë³€ê²½ì‹œ ëª¨ë“  SQLë¥¼ ìˆ˜ì •í•´ì•¼í•˜ëŠ”ë°
   - JPAëŠ” í•„ë“œë§Œ ì¶”ê°€í•˜ë©° SQLì€ JPAê°€ ì²˜ë¦¬í•œë‹¤.



#### JPAì™€ ì—°ê´€ ê´€ê³„, ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰

```
member.setTeam(team);
jpa.persist(member)
```

ë™ì¼í•œ íŠ¸ë™ì­ì…˜ì—ì„œ ì¡°íšŒí•œ ì•¤í‹°í‹°ëŠ” ê°™ìŒì„ ë³´ì¥í•œë‹¤.



#### JPAë¥¼ ì“°ë©´ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤?

JPA ê°™ì€ ì¤‘ê°„ ê³„ì¸µì´ ìˆë‹¤ë©´ ìºì‹±, ë²„í¼ë§ì„ ì§€ì›í•˜ê²Œ ëœë‹¤. ğŸ‘‰ ìµœì í™”ë¥¼ í†µí•´ ì„±ëŠ¥ì„ ëŒì–´ì˜¬ë¦´ ìˆ˜ë„ ìˆë‹¤.

ê°™ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œëŠ” ê°™ì€ ì•¤í‹°í‹°ë¥¼ ë°˜í™˜ ğŸ‘‰ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ

DB Isolation Levelì´ Read Commitì´ì–´ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Repeatable Read ë³´ì¥



#### íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°(ë²„í¼ë§ ê¸°ëŠ¥) - Insert

íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œê¹Œì§€ INSERT SQLì„ ëª¨ì€ë‹¤.

ë¹„ìŠ·í•œ ì¿¼ë¦¬ë¥¼ ë©”ëª¨ë¦¬ì— ìŒ“ì•„ì„œ ëª¨ì•„ì„œ commití•˜ê²Œ ëœë‹¤. 

```
em.persist(memberA);
em.persist(memberB);
em.persist(memberC);
```





#### ì§€ì—° ë¡œë”©ê³¼ ì¦‰ì‹œ ë¡œë”©âœ”

```
Member member = memberDAO.find(memberId);
Team team = member.getTeam();
String teamName = team.getName();
```



**ì§€ì—° ë¡œë”©** 

ê°ì²´ê°€ ì‹¤ì œ ì‚¬ìš©ë  ë•Œ ë¡œë”© (SELECT * FROM MEMBER / SELECT * FROM TEAM) - í•œ ê°€ì§€ë§Œ ì§‘ì¤‘í•´ì„œ ì“¸ ë•Œ



**ì¦‰ì‹œ ë¡œë”©** 

JOINìœ¼ë¡œ í•œ ë²ˆì— *ì—°ê´€ëœ ê°ì²´ê¹Œì§€* ë¯¸ë¦¬ ì¡°íšŒ (SELECT M.*, T.* FROM MEMBER JOIN TEAM ...) ë‘ ì—”í‹°í‹°ë¥¼ ê°™ì´ ìì£¼ ì“¸ ë•Œ

----------



**Repository**ëŠ” JPAë¥¼ ì‘ë™ì‹œí‚¤ëŠ” ë§¤ê°œì²´

í…Œì´ë¸” : domain

SQL - repository



@NoArgsConstructor : ê¸°ë³¸ ìƒì„±ìë¥¼ ëŒ€ì‹  ìƒì„±

@RequiredArgsConstructor : private finalë¡œ ì„ ì–¸ëœ ë³€ìˆ˜ë¥¼ ê°–ëŠ” ìƒì„±ìë¥¼ ìë™ ìƒì„±

@ Entiity: í…Œì´ë¸”ì„ì„ ëª…ì‹œ

@Id: idê°’, PKë¡œ ì‚¬ìš©í•˜ê² ë‹¤ëŠ” ëœ»

@GeneratedValue(strategy = GenerationType.AUTO) // ìë™ ì¦ê°€ ëª…ë ¹



putmapping

@Pathvariable



@AllArgsConstructor : ëª¨ë“  ë³€ìˆ˜ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ê°€ì§€ëŠ” ìƒì„±ì ìë™ ìƒì„±



DTOëŠ” Personì˜ ì‘ì—…ì„ í•œ ë²ˆ ê±°ì³ì„œ í•´ì¤€ë‹¤ëŠ” ëŠë‚Œì¸ ê²ƒ ê°™ë‹¤.





serviceì—ì„œ JPAë¥¼ ì‚¬ìš©í•˜ë©´ SQL Queryê°€ ì¼ì–´ë‚¨ì„ ì•Œë ¤ì£¼ëŠ” Transactionalì„ ë©”ì„œë“œì— ì„ ì–¸í•´ì¤˜ì•¼ í•œë‹¤

```java
@Transactional
public Long update(Long id, PersonRequestDto requestDto){
    Person findPerson = personRepository.findById(id).orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ì•„ì´ë””ë¥¼ ê°€ì§„ ì‚¬ëŒì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"));
    findPerson.update(requestDto);
    return findPerson.getId();
}
```





```javascript
$.ajax({
    type: "POST",
    url: "/api/memos",
    contentType: "application/json",
    data: JSON.stringify(data),
    success: function (response) {
        alert('ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        window.location.reload();
    }
});
```





```java
@SpringBootApplication
@EnableJpaAuditing
public class MyblogApplication {

   public static void main(String[] args) {
      SpringApplication.run(MyblogApplication.class, args);
   }

}
```



**<JPAì°¸ê³ ë§í¬>**

ì—°ê´€ê´€ê³„ ë§í¬.. JPAë¥¼ ì¢€ ë” ê³µë¶€í•˜ê³  ì¨ì•¼ í•  ê²ƒ ê°™ë‹¤. ë¬´ì‘ì • ì“°ë©´ í° ì½” ë‹¤ì¹  ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´.. ã… 

<https://ttl-blog.tistory.com/129>

<https://velog.io/@sa1341/JPA-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EB%B0%A9%EB%B2%95>

<https://velog.io/@sa1341/JPA-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91-%EB%B0%A9%EB%B2%95



ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ FKê°€ ìˆëŠ” ê³³.. í—ˆí—ˆ

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ì˜ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. ë¬´ìŠ¨ ë§ì´ê³ 

